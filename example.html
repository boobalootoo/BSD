<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Brighton Services Directory</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
    .subcategory-container { display: none; }
    .subcategory-container.active { display: grid; }
    #map { height: 400px; margin-top: 20px; border-radius: 12px; }
    .cat-active { outline: 3px solid rgba(59,130,246,.6); }
  </style>
</head>
<body class="flex flex-col min-h-screen">
  <!-- Header -->
  <header class="bg-white sticky top-0 z-50 shadow-sm p-4 flex items-center justify-between">
    <h1 class="text-2xl md:text-3xl font-bold text-gray-800">
      <i class="fa-solid fa-hand-holding-heart text-blue-600 mr-2"></i>
      Brighton Services Directory
    </h1>
    <a href="tel:999" class="bg-red-600 text-white rounded-full p-3 md:p-4 text-xl font-bold uppercase shadow-lg hover:bg-red-700 transition-colors duration-200" aria-label="Emergency Services 999">
      999
    </a>
  </header>

  <!-- Main -->
  <main class="flex-1 p-4 pb-24 md:p-6">
    <div class="max-w-4xl mx-auto">
      <!-- Filters -->
      <section class="mb-6">
        <h2 class="text-lg font-semibold text-gray-700 mb-2">Filters</h2>
        <div id="filter-container" class="grid grid-cols-2 sm:grid-cols-3 gap-2"></div>
      </section>

      <!-- Categories -->
      <section class="mb-6">
        <h2 class="text-lg font-semibold text-gray-700 mb-2">Categories</h2>
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 md:gap-6">
          <button class="category-btn bg-white rounded-xl shadow-md p-4 text-center hover:scale-105 transition" data-category="Health">
            <i class="fa-solid fa-heart-pulse text-4xl text-red-500 mb-2"></i>
            <span class="block font-medium">Health</span>
          </button>
          <button class="category-btn bg-white rounded-xl shadow-md p-4 text-center hover:scale-105 transition" data-category="Food">
            <i class="fa-solid fa-bread-slice text-4xl text-orange-500 mb-2"></i>
            <span class="block font-medium">Food</span>
          </button>
          <button class="category-btn bg-white rounded-xl shadow-md p-4 text-center hover:scale-105 transition" data-category="Accommodation">
            <i class="fa-solid fa-house-chimney text-4xl text-purple-500 mb-2"></i>
            <span class="block font-medium">Accommodation</span>
          </button>
          <button class="category-btn bg-white rounded-xl shadow-md p-4 text-center hover:scale-105 transition" data-category="Help into Work">
            <i class="fa-solid fa-briefcase text-4xl text-green-500 mb-2"></i>
            <span class="block font-medium">Help into Work</span>
          </button>
        </div>

        <!-- Subcategories -->
        <div id="subcategories-Health" class="subcategory-container grid-cols-2 gap-4 mt-4">
          <button class="subcategory-btn bg-white rounded-xl shadow p-4 text-center" data-subcategory="Physical Health">
            <i class="fa-solid fa-person text-3xl text-red-500 mb-2"></i>
            <span>Physical Health</span>
          </button>
          <button class="subcategory-btn bg-white rounded-xl shadow p-4 text-center" data-subcategory="Mental Health">
            <i class="fa-solid fa-brain text-3xl text-red-500 mb-2"></i>
            <span>Mental Health</span>
          </button>
        </div>
        <div id="subcategories-Food" class="subcategory-container grid-cols-2 gap-4 mt-4">
          <button class="subcategory-btn bg-white rounded-xl shadow p-4 text-center" data-subcategory="Meal Service">
            <i class="fa-solid fa-utensils text-3xl text-orange-500 mb-2"></i>
            <span>Meal Service</span>
          </button>
          <button class="subcategory-btn bg-white rounded-xl shadow p-4 text-center" data-subcategory="Shopping">
            <i class="fa-solid fa-cart-shopping text-3xl text-orange-500 mb-2"></i>
            <span>Shopping</span>
          </button>
        </div>
      </section>

      <!-- Services -->
      <section>
        <h2 class="text-lg font-semibold text-gray-700 mb-2">Services</h2>
        <div id="services-list" class="space-y-4"></div>
        <div id="no-services" class="hidden text-center text-gray-500 mt-8">
          <i class="fa-solid fa-face-sad-cry text-4xl mb-2"></i>
          <p class="text-lg font-medium">No services match your criteria.</p>
        </div>
      </section>

      <!-- Map -->
      <section>
        <h2 class="text-lg font-semibold text-gray-700 mt-6 mb-2">Map</h2>
        <div id="map"></div>
      </section>
    </div>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // --- Data ------------------------------------------------------------
      const services = [
        {
          id: 1, category: "Health", subCategory: "Mental Health",
          title: "Mind in Brighton and Hove",
          description: "Local mental health support and advice.",
          contact: "01273 666 950",
          filters: ["All","Men","Women","LGBTQ","Housed","Unhoused"],
          lat: 50.828, lng: -0.14, icon: "fa-solid fa-brain"
        },
        {
          id: 2, category: "Health", subCategory: "Physical Health",
          title: "GP Access Point",
          description: "Walk-in service for minor illnesses and injuries.",
          contact: "01273 203 040",
          filters: ["All","Men","Women","Children","Families","Housed"],
          lat: 50.830, lng: -0.135, icon: "fa-solid fa-stethoscope"
        },
        {
          id: 3, category: "Food", subCategory: "Meal Service",
          title: "Brighton Foodbank",
          description: "Provides emergency food parcels.",
          contact: "01273 625 159",
          filters: ["All","Families","Housed","Unhoused"],
          lat: 50.831, lng: -0.125, icon: "fa-solid fa-utensils"
        },
        {
          id: 4, category: "Food", subCategory: "Shopping",
          title: "Community Grocery",
          description: "Affordable groceries for members.",
          contact: "01273 555 123",
          filters: ["All","Housed"],
          lat: 50.827, lng: -0.130, icon: "fa-solid fa-cart-shopping"
        },
        {
          id: 5, category: "Accommodation", subCategory: "Emergency Shelter",
          title: "Shelter UK",
          description: "Offers free housing advice and support.",
          contact: "0344 515 1520",
          filters: ["All","Housed","Unhoused"],
          lat: 50.832, lng: -0.138, icon: "fa-solid fa-bed"
        },
        {
          id: 6, category: "Help into Work", subCategory: "Employment Support",
          title: "Jobcentre Plus",
          description: "Help with job seeking, training, and benefits.",
          contact: "0800 169 0190",
          filters: ["All","Men","Women","Housed","Unhoused"],
          lat: 50.829, lng: -0.136, icon: "fa-solid fa-user-tie"
        }
      ];

      const filters = ["Men","Women","Children","Families","LGBTQ","Housed","Unhoused"];

      // --- DOM refs --------------------------------------------------------
      const filterContainer = document.getElementById("filter-container");
      const servicesList = document.getElementById("services-list");
      const noServicesMessage = document.getElementById("no-services");

      // --- State -----------------------------------------------------------
      let activeFilters = new Set();
      let activeCategory = null;
      let activeSubcategory = null;

      // --- Map -------------------------------------------------------------
      const map = L.map("map").setView([50.828, -0.14], 13);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "&copy; OpenStreetMap contributors"
      }).addTo(map);
      let markers = [];

      // Category icon mapping (fallback if no subcategory icon defined)
      const categoryMarkerIcons = {
        "Health": { icon: "fa-solid fa-heart-pulse", color: "text-red-500", bg: "bg-red-100" },
        "Food": { icon: "fa-solid fa-bread-slice", color: "text-orange-500", bg: "bg-orange-100" },
        "Accommodation": { icon: "fa-solid fa-house-chimney", color: "text-purple-500", bg: "bg-purple-100" },
        "Help into Work": { icon: "fa-solid fa-briefcase", color: "text-green-500", bg: "bg-green-100" }
      };

      // Subcategory icon mapping (used when available)
      const subcategoryMarkerIcons = {
        "Physical Health": { icon: "fa-solid fa-person", color: "text-red-500", bg: "bg-red-100" },
        "Mental Health": { icon: "fa-solid fa-brain", color: "text-red-500", bg: "bg-red-100" },
        "Meal Service": { icon: "fa-solid fa-utensils", color: "text-orange-500", bg: "bg-orange-100" },
        "Shopping": { icon: "fa-solid fa-cart-shopping", color: "text-orange-500", bg: "bg-orange-100" }
      };

      function makeDivIcon(opts) {
        return L.divIcon({
          className: "",
          html: `
            <div class="w-10 h-10 flex items-center justify-center rounded-full shadow ${opts.bg}">
              <i class="${opts.icon} ${opts.color} text-lg"></i>
            </div>
          `,
          iconSize: [40, 40],
          iconAnchor: [20, 20],
          popupAnchor: [0, -22]
        });
      }

      function updateMap(filtered) {
        // Clear existing markers
        markers.forEach(m => map.removeLayer(m));
        markers = [];

        // Add markers with correct (sub)category icon
        filtered.forEach(s => {
          const iconSpec = subcategoryMarkerIcons[s.subCategory] || categoryMarkerIcons[s.category];
          const divIcon = makeDivIcon(iconSpec);
          const marker = L.marker([s.lat, s.lng], { icon: divIcon })
            .bindPopup(`
              <div class="font-semibold">${s.title}</div>
              <div class="text-sm text-gray-600">${s.category} · ${s.subCategory || ""}</div>
              <div class="text-sm mt-1">${s.description}</div>
              <div class="mt-2 text-sm">
                <i class="fa-solid fa-phone mr-1"></i>
                <a href="tel:${s.contact.replace(/\s/g,"")}" class="text-blue-600 hover:underline">${s.contact}</a>
              </div>
            `)
            .addTo(map);
          markers.push(marker);
        });

        if (filtered.length > 0) {
          const group = L.featureGroup(markers);
          map.fitBounds(group.getBounds().pad(0.3));
        }
      }

      // --- Filters (checkboxes) -------------------------------------------
      filters.forEach(f => {
        const label = document.createElement("label");
        label.className = "flex items-center gap-2 bg-white p-2 rounded shadow cursor-pointer";
        const input = document.createElement("input");
        input.type = "checkbox"; input.value = f;
        input.addEventListener("change", () => {
          if (input.checked) activeFilters.add(f); else activeFilters.delete(f);
          renderServices();
        });
        const span = document.createElement("span"); span.textContent = f;
        label.appendChild(input); label.appendChild(span);
        filterContainer.appendChild(label);
      });

      // --- Category buttons ------------------------------------------------
      document.querySelectorAll(".category-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          // Visual state
          document.querySelectorAll(".category-btn").forEach(b => b.classList.remove("cat-active"));
          btn.classList.add("cat-active");

          activeCategory = btn.dataset.category;
          activeSubcategory = null;

          // Show only the clicked category's subcategories
          document.querySelectorAll(".subcategory-container").forEach(el => el.classList.remove("active"));
          document.getElementById("subcategories-" + activeCategory)?.classList.add("active");

          renderServices();
        });
      });

      // --- Subcategory buttons --------------------------------------------
      document.querySelectorAll(".subcategory-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          // Optional: highlight chosen subcat button
          document.querySelectorAll(`#subcategories-${activeCategory} .subcategory-btn`).forEach(b => b.classList.remove("cat-active"));
          btn.classList.add("cat-active");

          activeSubcategory = btn.dataset.subcategory;
          renderServices();
        });
      });

      // --- Render services + map ------------------------------------------
      function renderServices() {
        const filtered = services.filter(s => {
          if (activeCategory && s.category !== activeCategory) return false;
          if (activeSubcategory && s.subCategory !== activeSubcategory) return false;
          if (activeFilters.size > 0) {
            // service shown if it matches any selected filter, or has "All"
            return [...activeFilters].some(f => s.filters.includes(f)) || s.filters.includes("All");
          }
          return true;
        });

        servicesList.innerHTML = "";
        if (filtered.length === 0) {
          noServicesMessage.classList.remove("hidden");
        } else {
          noServicesMessage.classList.add("hidden");
          filtered.forEach(s => {
            const card = document.createElement("div");
            card.className = "bg-white rounded-xl shadow p-4 flex items-start gap-4 transition-transform transform hover:scale-[1.01]";
            // choose list icon: prefer subcategory icon, else category icon
            const listIconSpec = subcategoryMarkerIcons[s.subCategory] || categoryMarkerIcons[s.category];
            card.innerHTML = `
              <div class="w-12 h-12 flex items-center justify-center rounded-full ${listIconSpec.bg}">
                <i class="${listIconSpec.icon} ${listIconSpec.color} text-xl"></i>
              </div>
              <div>
                <h3 class="font-bold text-lg text-gray-800">${s.title}</h3>
                <p class="text-sm text-gray-500 mb-1">${s.category}${s.subCategory ? " · " + s.subCategory : ""}</p>
                <p class="text-gray-700 mb-2">${s.description}</p>
                <a href="tel:${s.contact.replace(/\s/g,"")}" class="text-sm text-blue-600 hover:underline">
                  <i class="fa-solid fa-phone mr-1"></i>${s.contact}
                </a>
              </div>
            `;
            servicesList.appendChild(card);
          });
        }

        updateMap(filtered);
      }

      // Initial render
      renderServices();
    });
  </script>
</body>
</html>
